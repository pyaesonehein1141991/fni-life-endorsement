<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets" xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core" xmlns:fu="http://java.sun.com/jsf/fileUpload" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" template="/common/commonLayout.xhtml">
   <ui:param name="header" value="Add Express DetailS"/>
   <ui:param name="headerRendered" value="true"/>
   <ui:define name="content">
      <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
      <link href="#{request.contextPath}/css/inputText.css" rel="stylesheet" type="text/css"/>
      <h:form id="travelProposalDetailEntryForm">
         <p:growl escape="false" globalOnly="true" id="message" life="8000" showDetail="true"/>
           <p:panelGrid columns="2" columnClasses="ui-grid-col-6,ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
				<p:panelGrid id="travelPanel" columns="2" columnClasses="ui-grid-col-4,ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank ui-fluid"> 
                    <h:outputText styleClass="input-label" value="Proposal No"/>
                    <p:inputText id="proposalNO"  value="#{AddNewExpressDetailActionBean.travelExpress.travelProposal.proposalNo}"/>
                     <p:outputLabel />
                    <p:message for="expressName" display="text"/> 
                    <h:outputText styleClass="input-label mandatory" value="Express Name"/>
                    <p:inputText id="expressName"  value="#{AddNewExpressDetailActionBean.travelExpress.express.name}"/>
                    <p:outputLabel />
                    <p:message for="occurrence" display="text"/> 
                    <h:outputText styleClass="input-label mandatory" value="Tour "/>
                    <p:panelGrid styleClass="ui-panelgrid-blank">
						<div style="margin: -6px;" class="ui-g ui-fluid" id="occurrencePanelGroup">
							<div class="ui-inputgroup ui-g-12 ui-lg-12 ui-lg-12">
								<p:commandButton styleClass="green-button" icon="fa fa-search" actionListener="#{AddNewExpressDetailActionBean.selectOccurrence()}" id="selectOccurrenceDialogLink" process="@this">
									<p:ajax event="dialogReturn" listener="#{AddNewExpressDetailActionBean.returnOccurrence}" update="occurrence" />
								</p:commandButton>
								<p:inputText id="occurrence" readonly="true" required="true"
									value="#{AddNewExpressDetailActionBean.tour.occurrence == null ? '' : AddNewExpressDetailActionBean.tour.occurrence.description}" />
								<p:commandButton styleClass="red-button" icon="fa fa-times" action="#{AddNewExpressDetailActionBean.tour.setOccurrence(null)}" process="@this" update="occurrence" />
							</div>
						</div>
					</p:panelGrid>
                        <p:commandButton action="#{AddNewExpressDetailActionBean.addTour()}" id="addBtn" rendered="#{AddNewExpressDetailActionBean.createNew}" style="width:80px;" update="message travelPanel expressListPanel" value="#{label['COMMON_ADDNEW_BTN']}"/>
                        <p:commandButton action="#{AddNewExpressDetailActionBean.editTour()}" id="editBtn" rendered="#{!AddNewExpressDetailActionBean.createNew}" style="width:80px;" update=":travelProposalDetailEntryForm" value="#{label['COMMON_UPDATE_BTN']}"/>
              </p:panelGrid>
              </p:panelGrid>      
            <p:separator />
            <h:commandLink action="#{AddNewExpressDetailActionBean.createNewTour()}">
               <f:ajax render="travelPanel"/>
               <h:panelGrid columns="2">
                  <p:graphicImage styleClass="#{ApplicationSetting.addStyleClass}" value="#{ApplicationSetting.addIcon}"/>
                  <h:outputText styleClass="command-link" value="#{label['COMMON_ADDNEW_LINK']}"/>
               </h:panelGrid>
            </h:commandLink>
            <p:panel id="expressListPanel" >
               <p:dataTable id="tourTable" paginator="true" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowIndexVar="index" rows="10" rowsPerPageTemplate="10,20, 30" style="width:100%" value="#{AddNewExpressDetailActionBean.tourList}" var="tour" widgetVar="tourTable">
                  <p:column headerText="No." style="width:20px;text-align:center;">
                     <h:outputText value="#{index + 1}"/>
                  </p:column>
                  <p:column headerText="Tour" style="width:100px;text-align:center;">
                     <h:outputText value="#{tour.occurrence.description}"/>
                     <f:facet name="footer">
						<b>Total </b>
					</f:facet>
                  </p:column>
                  <p:column headerText="No.OfPassengers" style="width:60px;text-align:center;">
                    <h:outputText value="#{tour.noOfPassenger}">
						<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
					</h:outputText>
                     <f:facet name="footer">
						<b>
						<h:outputText value="#{AddNewExpressDetailActionBean.tempTotalPassenger}">
							<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
						</h:outputText>
						</b>
					</f:facet>
                  </p:column>
                  <p:column headerText="No.OfUnits" style="width:60px;text-align:center;">
                    <h:outputText value="#{tour.noOfUnit}">
						<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
					</h:outputText>
                     <f:facet name="footer">
						<b>
						<h:outputText value="#{AddNewExpressDetailActionBean.tempTotalUnit}">
							<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
						</h:outputText>
						</b>
					</f:facet>
                  </p:column>
                  <p:column headerText="Net Premium" style="width:70px;text-align:center;">
					<h:outputText value="#{tour.netPremium}">
						<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
					</h:outputText>
                     <f:facet name="footer">
						<b>
						<h:outputText value="#{AddNewExpressDetailActionBean.tempTotalNetPremium}">
							<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
						</h:outputText>
						</b>
					</f:facet>
                     
                  </p:column>
                  <p:column headerText="Express Details" style="width:30px;text-align:center;">
                     <p:commandLink action="#{AddNewExpressDetailActionBean.prepareExpressDetail(tour)}" id="settingLink2" oncomplete="PF('expressDetailDialog').show();" update=":expressListForm">
                        <h:graphicImage styleClass="#{ApplicationSetting.addStyleClass}" url="#{ApplicationSetting.addIcon}"/>
                        <p:ajax event="dialogReturn"/>
                     </p:commandLink>
                  </p:column>
                  <p:column headerText="Details" style="width:30px;text-align:center;">
                     <p:commandLink action="#{AddNewExpressDetailActionBean.prepareEntries(tour)}" id="expressDetails" immediate="true" oncomplete="PF('expressDetailByDateDialog').show();" update=":expressDetailListForm:expressDetailByDatePanel">
                        <h:graphicImage styleClass="#{ApplicationSetting.detailStyleClass}" url="#{ApplicationSetting.detailIcon}"/>
                         <p:ajax event="dialogReturn"/>
                     </p:commandLink>
                  </p:column>
                  <p:column style="width:30px;text-align:center;">
                     <p:commandLink action="#{AddNewExpressDetailActionBean.prepareEditTour(tour)}" id="editTourLink" update=":travelProposalDetailEntryForm:travelPanel">
                        <p:graphicImage styleClass="#{ApplicationSetting.editStyleClass}" value="#{ApplicationSetting.editIcon}"/>
                     </p:commandLink>
                  </p:column>
                  <p:column style="width:30px;text-align:center;">
                     <p:commandLink id="deleteTourLink" oncomplete="PF('confirmationDialog').show();" update=":travelProposalDetailEntryForm:expressListPanel">
                        <f:setPropertyActionListener target="#{AddNewExpressDetailActionBean.tour}" value="#{tour}"/>
                        <p:graphicImage styleClass="#{ApplicationSetting.deleteStyleClass}" value="#{ApplicationSetting.deleteIcon}"/>
                     </p:commandLink>
                  </p:column>
               </p:dataTable>
            </p:panel>
            <br/>
            <p:commandButton action="#{AddNewExpressDetailActionBean.updateTravelExpress()}" id="submitBtn" style="width:80px;" update=":travelProposalDetailEntryForm" value="Save" immediate="true"/>
            <p:spacer width="5"/>
            <p:commandButton action="enquiryExpressDetail" id="backBtn" immediate="true" style="width:80px;" update=":travelProposalDetailEntryForm" value="Back"/>
      </h:form>
      <p:dialog height="400" hideEffect="explode" id="expressDetailByDateDialog" resizable="false" showEffect="explode" widgetVar="expressDetailByDateDialog" width="900">
		<h:form id="expressDetailListForm">
			<p:panel header="Express Details (#{AddNewExpressDetailActionBean.tour.occurrence.description})" id="expressDetailByDatePanel" styleClass="customTitleBar">
       			<p:dataTable id="proposalPanel" rowIndexVar="index" style="width:100%;" styleClass="borderless" value="#{AddNewExpressDetailActionBean.entries}" var="proposal">
       				<p:column>
       					<p:panel collapsed="true" header="Date -  #{proposal.key}" id="dataTablePanel" style="border: none;" toggleable="true">
			        		<p:dataTable id="expressTable" rowIndexVar="index" rowStyleClass="#{(index mod 2) eq 0 ? 'second-row' : 'first-row'}" style="width:100%;" value="#{proposal.value}" var="expressDetail">
			                 <p:column style="width:5px;text-align:centre;">
			                    <h:outputText value="#{index + 1}"/>
			                 </p:column>
			                  <p:column style="width:10px;text-align:right;">
			                 	 <h:outputText value="Registration No - #{expressDetail.registrationNo}"/>
			                 	    <f:facet name="footer">
										<b>Total</b>
									</f:facet>
			                  </p:column>
			                  <p:column style="width:20px;text-align:right;">
			                     <h:outputText value="#{expressDetail.noOfPassenger} Passengers"/>
			                         <f:facet name="footer">
										<b>
										<h:outputText style="width:10px;text-align:center;" value="#{AddNewExpressDetailActionBean.expressDetailForTotalMap.get(proposal.key).noOfPassenger} Passengers">
											<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
										</h:outputText>
										</b>
									</f:facet>
			                  </p:column>
			                  <p:column style="width:50px;text-align:right;">
			                     <h:outputText value="#{expressDetail.noOfUnit} Units"/>
			                         <f:facet name="footer">
										<b>
										<h:outputText style="width:10px;text-align:center;" value="#{AddNewExpressDetailActionBean.expressDetailForTotalMap.get(proposal.key).noOfUnit} Units">
											<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
										</h:outputText>
										</b>
									</f:facet>
			                  </p:column>
			                  <p:column style="width:20px;text-align:right;">
			                     <h:outputText value="#{expressDetail.netPremium}"/>
			                         <f:facet name="footer">
										<b>
										<h:outputText style="width:10px;text-align:center;" value="#{AddNewExpressDetailActionBean.expressDetailForTotalMap.get(proposal.key).netPremium}">
											<f:convertNumber pattern="#{ApplicationSetting.currencyFormat}"/>
										</h:outputText>
										</b>
									</f:facet>
			                  </p:column>
			              </p:dataTable>
		              </p:panel>
	              </p:column>
	            </p:dataTable>
        	</p:panel>
		</h:form>
      </p:dialog>
      
      <p:dialog modal="true" appendTo="@(body)" dynamic="true" height="400" hideEffect="explode" id="expressDetailDialog" resizable="false" showEffect="explode" widgetVar="expressDetailDialog" width="1000">
         <h:form id="expressListForm">
            <p:growl escape="false" globalOnly="true" life="8000" showDetail="true"/>
            <p:separator style="height:3px; margin-top:-1px;width:110%;"/>
                <p:panelGrid style="margin: 10px;" columns="2" columnClasses="ui-grid-col-6,ui-grid-col-6" layout="grid" styleClass="ui-fluid">
					<p:panelGrid id="expressDetailPanel" style="margin: 10px;" columns="2" columnClasses="ui-grid-col-4,ui-grid-col-6" layout="grid" styleClass="ui-panelgrid-blank ui-fluid">
               			<p:outputLabel/>
                        <p:message for="regNo" id="regNoMsg" display="text"/>
                        <h:outputText styleClass="input-label mandatory" value="Registration No. "/>
                        <p:inputText id="regNo" value="#{AddNewExpressDetailActionBean.expressDetail.registrationNo}"/>
                    	<p:outputLabel/>
                        <p:message for="noOfPassenger" id="noOfPassengerMsg" display="text"/>
                        <h:outputText styleClass="input-label mandatory" value="No. Of Passenger "/>
                        <p:inputText id="noOfPassenger" onkeyup="copy(this)" value="#{AddNewExpressDetailActionBean.expressDetail.noOfPassenger}"/>
                    	<p:outputLabel/>
                        <p:message for="noOfUnit" id="noOfUnitMsg" display="text"/>
                        <h:outputText styleClass="input-label mandatory" value="No. Of Unit "/>
                        <p:inputText id="noOfUnit" value="#{AddNewExpressDetailActionBean.expressDetail.noOfUnit}"/>
                     	<p:outputLabel/>
						<p:message for="Date" display="text"/>
						<h:outputText styleClass="input-label mandatory" value=" Date "/>
						<p:calendar id="Date"  pattern="#{ApplicationSetting.dateFormat}" showOn="button" timeZone="#{ApplicationSetting.timeZone}" value="#{AddNewExpressDetailActionBean.expressDetail.date}"/>
						<h:outputText styleClass="input-label" value="Remark "/>
                        <p:inputTextarea value="#{AddNewExpressDetailActionBean.expressDetail.remark}"/>
                        <p:commandButton action="#{AddNewExpressDetailActionBean.addExpressDetail()}" id="expressDetailAddBtn" process="@all" rendered="#{AddNewExpressDetailActionBean.createNew}" update=":expressListForm" value="Add"/>
                        <p:commandButton action="#{AddNewExpressDetailActionBean.editExpressDetail()}" id="expressDetailUpdateBtn" process="@all" rendered="#{!AddNewExpressDetailActionBean.createNew}" update=":expressListForm" value="Update"/>
                 </p:panelGrid>
               </p:panelGrid>    
            <p:separator style="height:3px; margin-top:-1px;width:110%;"/>
            <p:panel id="expressDetailListPanel" >
               <p:dataTable id="expressDetailTable" rowIndexVar="index" rowStyleClass="#{(index mod 2) eq 0 ? 'second-row' : 'first-row'}" style="width:100%;" value="#{AddNewExpressDetailActionBean.tour.expressDetailList}" var="expressDetail">
                  <p:column headerText="No." style="width:4%">
                     <h:outputText value="#{index + 1}"/>
                  </p:column>
                  <p:column headerText="RegistrationNo." style="text-align:center;">
                     <h:outputText value="#{expressDetail.registrationNo}"/>
                  </p:column>
                  <p:column headerText="No.ofPassenger" style="text-align:center;">
                     <h:outputText value="#{expressDetail.noOfPassenger}"/>
                  </p:column>
                  <p:column headerText="No.ofUnit" style="text-align:center;">
                     <h:outputText value="#{expressDetail.noOfUnit}"/>
                  </p:column>
                  <p:column headerText="Total Premium" style="text-align:center;">
                     <h:outputText value="#{expressDetail.premium}"/>
                  </p:column>
                  <p:column headerText="Net Premium" style="text-align:center;">
                     <h:outputText value="#{expressDetail.netPremium}"/>
                  </p:column>
                  <p:column headerText="Date" style="text-align:center;">
					<h:outputText pattern="#{ApplicationSetting.dateFormat}" value="#{expressDetail.date}">
					  <f:convertDateTime pattern="#{ApplicationSetting.dateFormat}" timeZone="#{ApplicationSetting.timeZone}"/>
					</h:outputText>
                  </p:column>
                  <p:column headerText="Remark">
                     <h:outputText value="#{expressDetail.remark}"/>
                  </p:column>
                  <p:column style="width:30px;">
                     <p:commandLink action="#{AddNewExpressDetailActionBean.prepareEditExpressDetail(expressDetail)}" id="editExpressDetailLink" update=":expressListForm">
                        <p:graphicImage styleClass="#{ApplicationSetting.editStyleClass}" value="#{ApplicationSetting.editIcon}"/>
                     </p:commandLink>
                  </p:column>
                  <p:column style="width:30px;">
                  	<p:commandLink id="deleteExpressDetailLink" action="#{AddNewExpressDetailActionBean.deleteExpressDetail(expressDetail)}" update=":expressListForm">
                  		<p:graphicImage styleClass="#{ApplicationSetting.deleteStyleClass}" value="#{ApplicationSetting.deleteIcon}"/>
                  	</p:commandLink>
                  </p:column>
               </p:dataTable>
            </p:panel>
            <br/>
            <p:commandButton action="#{AddNewExpressDetailActionBean.saveExpressDetailList}" id="saveExpressDetailBtn" oncomplete="PF('expressDetailDialog').hide();" update=":travelProposalDetailEntryForm" value="Save"/>
         </h:form>
      </p:dialog>
      <!-- Confirmation Dialog -->
      <h:form id="confiationForm">
         <p:dialog header="#{label['MANAGE_TOUR_DELETE_CONFIRM']}" height="100" hideEffect="explode" id="confirmationDialog" resizable="false" showEffect="explode" widgetVar="confirmationDialog" width="350">
            <h:panelGroup id="confirmationPanel">
               <table>
                  <tr>
                     <td align="left">
                        <h:graphicImage style="width:30px;height:30px;" url="/images/warning.png"/>
                     </td>
                     <td valign="middle">
                        <h:outputText style="padding-top:-10px;text-decoration: none;font-size: 12px;" value="#{label['COMMON_MSG_DELETE_CONFIRM_LABEL']}"/>
                     </td>
                  </tr>
               </table>
               <br/>
               <p:commandButton action="#{AddNewExpressDetailActionBean.deleteTour()}" oncomplete="PF('confirmationDialog').hide();" update=":travelProposalDetailEntryForm:expressListPanel" value="#{label['COMMON_YES_BTN']}"/>
               <p:commandButton immediate="true" oncomplete="PF('confirmationDialog').hide();" value="#{label['COMMON_NO_BTN']}"/>
            </h:panelGroup>
         </p:dialog>
      </h:form>
      <!-- eDetail Confirmation Dialog -->
      <h:form id="eDetailConfiationForm">
         <p:dialog header="#{label['MANAGE_EXPRESSDETAIL_DELETE_CONFIRM']}" height="100" hideEffect="explode" id="eDetailConfirmationDialog" resizable="false" showEffect="explode" widgetVar="eDetailConfirmationDialog" width="250">
            <h:panelGroup id="confirmationPanel">
               <table>
                  <tr>
                     <td align="left">
                        <h:graphicImage style="width:30px;height:30px;" url="/images/warning.png"/>
                     </td>
                     <td valign="middle">
                        <h:outputText style="padding-top:-10px;text-decoration: none;font-size: 12px;" value="#{label['COMMON_MSG_DELETE_CONFIRM_LABEL']}"/>
                     </td>
                  </tr>
               </table>
               <br/>
               <p:commandButton action="#{AddNewExpressDetailActionBean.deleteExpressDetail}" oncomplete="PF('eDetailConfirmationDialog').hide();" update=":expressListForm:expressDetailListPanel" value="#{label['COMMON_YES_BTN']}"/>
               <p:commandButton immediate="true" oncomplete="PF('eDetailConfirmationDialog').hide();" value="#{label['COMMON_NO_BTN']}"/>
            </h:panelGroup>
         </p:dialog>
      </h:form>
   </ui:define>
</ui:composition>